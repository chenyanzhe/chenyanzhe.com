sudo: false
language: python
python:
- "3.6"
branches:
  only:
  - master
addons:
  ssh_known_hosts: 139.224.129.61

before_install:
- openssl aes-256-cbc -K $encrypted_2eeb5739b1e1_key -iv $encrypted_2eeb5739b1e1_iv
  -in travis.pem.enc -out travis.pem -d && chmod 400 travis.pem
- mkdir -p content
  # This workaround is required to avoid libstdc++ errors while running "extended" hugo with SASS support.
- sudo dpkg --force-all -i build/libstdc++6

install:
- build/hugo version
- pip install Pygments
- rm -rf public 2> /dev/null

script:
- build/hugo &&
  rsync -avz -e "ssh -i travis.pem" --delete public/ root@139.224.129.61:/var/www/ &&
  ssh -i travis.pem root@139.224.129.61 "chown -R www-data:www-data /var/www"